---
- name: Include create_services_json.yml
  ansible.builtin.import_playbook: create_services_json.yml

- name: Test services present slice
  hosts: ipaserver
  become: true
  gather_facts: false

  vars:
    slice_size: 500
  tasks:
  - name: Include services.json
    ansible.builtin.include_vars:
      file: services.json  # noqa 505
  - name: Include hosts.json
    ansible.builtin.include_vars:
      file: hosts.json  # noqa 505
  - name: Size of services slice.
    ansible.builtin.debug:
      msg: "{{ service_list | length }}"
  - name: Size of hosts slice.
    ansible.builtin.debug:
      msg: "{{ host_list | length }}"
  - name: Hosts present
    ipahost:
      ipaadmin_password: SomeADMINpassword
      hosts: "{{ host_list[item : item + slice_size] }}"
    loop: "{{ range(0, service_list | length, slice_size) | list }}"
  - name: Services present
    ipaservice:
      ipaadmin_password: SomeADMINpassword
      services: "{{ service_list[item : item + slice_size] }}"
    loop: "{{ range(0, service_list | length, slice_size) | list }}"

- name: Remove services.json
  hosts: localhost
  tasks:
  - name: Remove services.json
    ansible.builtin.file:
      state: absent
      path: services.json
  - name: Remove hosts.json
    ansible.builtin.file:
      state: absent
      path: hosts.json
